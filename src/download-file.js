"use strict";
// event data:
// {
//   "Records": [
//     {
//       "eventID": "4cff18fbf6c5a7fb9db7008add5af874",
//       "eventName": "INSERT",
//       "eventVersion": "1.1",
//       "eventSource": "aws:dynamodb",
//       "awsRegion": "us-west-2",
//       "dynamodb": {
//         "ApproximateCreationDateTime": 1582405136,
//         "Keys": {
//           "itemId": {
//             "S": "5055310"
//           }
//         },
//         "NewImage": {
//           "date": {
//             "S": "02/03/2020"
//           },
//           "itemId": {
//             "S": "5055310"
//           },
//           "documentType": {
//             "S": "WELL ABANDONMENT REPORT (INTENT)"
//           },
//           "downloadUrl": {
//             "S": "http://ogccweblink.state.co.us/DownloadDocumentPDF.aspx?DocumentId=5055310"
//           }
//         },
//         "SequenceNumber": "89300000000054786958328",
//         "SizeBytes": 169,
//         "StreamViewType": "NEW_IMAGE"
//       },
//       "eventSourceARN": "arn:aws:dynamodb:us-west-2:839811712080:table/cogcc-pdf-urls/stream/2020-02-22T20:53:55.247"
//     }
//   ]
// }
Object.defineProperty(exports, "__esModule", { value: true });
// import * as AWS from "aws-sdk";
// function download(url: string, dest: string) {
//   // Defines writable stream to out
//   // const file = fs.createWriteStream(dest);
//   http.get(url, function(response) {
//     response.pipe(file);
//   });
// }
// download(
//   "http://ogccweblink.state.co.us/DownloadDocumentPDF.aspx?DocumentId=2627568",
//   "output.pdf",
//   () => {
//     console.log("Done");
//   }
// );
// // // //
const http = require("http");
const fs = require("fs");
const AWS = require("aws-sdk");
const s3obj = new AWS.S3();
const S3_BUCKET_NAME = process.env.S3_BUCKET_NAME || "";
// // // //
// Downloads a file from a URL and writes it to `./tmp/filename
// TODO - should have error handler + error logging
function downloadFile(url, dest) {
    return new Promise(resolve => {
        const file = fs.createWriteStream(dest);
        console.log("created file write stream: " + dest);
        http.get(url, response => {
            console.log("downloaded file: " + url);
            response.pipe(file);
            file.on("finish", function () {
                console.log("wrote to file");
                file.close();
                resolve();
            });
        });
    });
}
// // // //
exports.handler = async (event = {}) => {
    // Logs start message + S3_BUCKET_NAME
    console.log("download-file --> START");
    console.log(`writing to S3 bucket: ${S3_BUCKET_NAME}`);
    // Debug event input
    console.log(JSON.stringify(event, null, 4));
    // Pulls newItem from event
    const newItem = event["Records"][0]["dynamodb"]["NewImage"];
    if (!newItem) {
        return;
    }
    // Pulls downloadUrl from newItem
    const downloadUrl = newItem["downloadUrl"]["S"];
    const documentId = newItem["itemId"]["S"];
    if (!downloadUrl) {
        return;
    }
    // Defines filename - used to save locally to lambda (in /tmp) AND in S3 bucket
    const filename = documentId + ".pdf";
    const filepath = "/tmp/" + filename;
    // Logs downloadUrl
    console.log(`downloadUrl: ${downloadUrl}`);
    console.log(`documentId: ${documentId}`);
    console.log(`filepath: ${filepath}`);
    // Downloads file to /tmp
    await downloadFile(downloadUrl, filepath);
    // Saves new file to S3
    s3obj
        .upload({
        Bucket: S3_BUCKET_NAME,
        Key: documentId + ".pdf",
        Body: fs.readFileSync(filepath)
    })
        .send((err, data) => {
        console.log(err, data);
        // Logs error
        // TODO - wire up proper error logging
        if (err) {
            console.log(`download-file --> ERROR`);
            console.log(err);
            return;
        }
        console.log(`download-file --> SUCCESS --> ${filename}`);
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG93bmxvYWQtZmlsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRvd25sb2FkLWZpbGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLGNBQWM7QUFDZCxJQUFJO0FBQ0osaUJBQWlCO0FBQ2pCLFFBQVE7QUFDUix1REFBdUQ7QUFDdkQsK0JBQStCO0FBQy9CLCtCQUErQjtBQUMvQix1Q0FBdUM7QUFDdkMsa0NBQWtDO0FBQ2xDLHNCQUFzQjtBQUN0QixxREFBcUQ7QUFDckQsb0JBQW9CO0FBQ3BCLHdCQUF3QjtBQUN4Qiw2QkFBNkI7QUFDN0IsY0FBYztBQUNkLGFBQWE7QUFDYix3QkFBd0I7QUFDeEIsc0JBQXNCO0FBQ3RCLGdDQUFnQztBQUNoQyxlQUFlO0FBQ2Ysd0JBQXdCO0FBQ3hCLDZCQUE2QjtBQUM3QixlQUFlO0FBQ2YsOEJBQThCO0FBQzlCLHNEQUFzRDtBQUN0RCxlQUFlO0FBQ2YsNkJBQTZCO0FBQzdCLGdHQUFnRztBQUNoRyxjQUFjO0FBQ2QsYUFBYTtBQUNiLHVEQUF1RDtBQUN2RCw0QkFBNEI7QUFDNUIsd0NBQXdDO0FBQ3hDLFdBQVc7QUFDWCx3SEFBd0g7QUFDeEgsUUFBUTtBQUNSLE1BQU07QUFDTixJQUFJOztBQUVKLGtDQUFrQztBQUVsQyxpREFBaUQ7QUFDakQsc0NBQXNDO0FBQ3RDLGdEQUFnRDtBQUNoRCx1Q0FBdUM7QUFDdkMsMkJBQTJCO0FBQzNCLFFBQVE7QUFDUixJQUFJO0FBRUosWUFBWTtBQUNaLGtGQUFrRjtBQUNsRixrQkFBa0I7QUFDbEIsWUFBWTtBQUNaLDJCQUEyQjtBQUMzQixNQUFNO0FBQ04sS0FBSztBQUVMLFdBQVc7QUFFWCw2QkFBNkI7QUFDN0IseUJBQXlCO0FBQ3pCLCtCQUErQjtBQUMvQixNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUMzQixNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsSUFBSSxFQUFFLENBQUM7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Q0FBQyxDQUFDO1lBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDakIsT0FBTztTQUNSO1FBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQ0FBaUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUMzRCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGV2ZW50IGRhdGE6XG4vLyB7XG4vLyAgIFwiUmVjb3Jkc1wiOiBbXG4vLyAgICAge1xuLy8gICAgICAgXCJldmVudElEXCI6IFwiNGNmZjE4ZmJmNmM1YTdmYjlkYjcwMDhhZGQ1YWY4NzRcIixcbi8vICAgICAgIFwiZXZlbnROYW1lXCI6IFwiSU5TRVJUXCIsXG4vLyAgICAgICBcImV2ZW50VmVyc2lvblwiOiBcIjEuMVwiLFxuLy8gICAgICAgXCJldmVudFNvdXJjZVwiOiBcImF3czpkeW5hbW9kYlwiLFxuLy8gICAgICAgXCJhd3NSZWdpb25cIjogXCJ1cy13ZXN0LTJcIixcbi8vICAgICAgIFwiZHluYW1vZGJcIjoge1xuLy8gICAgICAgICBcIkFwcHJveGltYXRlQ3JlYXRpb25EYXRlVGltZVwiOiAxNTgyNDA1MTM2LFxuLy8gICAgICAgICBcIktleXNcIjoge1xuLy8gICAgICAgICAgIFwiaXRlbUlkXCI6IHtcbi8vICAgICAgICAgICAgIFwiU1wiOiBcIjUwNTUzMTBcIlxuLy8gICAgICAgICAgIH1cbi8vICAgICAgICAgfSxcbi8vICAgICAgICAgXCJOZXdJbWFnZVwiOiB7XG4vLyAgICAgICAgICAgXCJkYXRlXCI6IHtcbi8vICAgICAgICAgICAgIFwiU1wiOiBcIjAyLzAzLzIwMjBcIlxuLy8gICAgICAgICAgIH0sXG4vLyAgICAgICAgICAgXCJpdGVtSWRcIjoge1xuLy8gICAgICAgICAgICAgXCJTXCI6IFwiNTA1NTMxMFwiXG4vLyAgICAgICAgICAgfSxcbi8vICAgICAgICAgICBcImRvY3VtZW50VHlwZVwiOiB7XG4vLyAgICAgICAgICAgICBcIlNcIjogXCJXRUxMIEFCQU5ET05NRU5UIFJFUE9SVCAoSU5URU5UKVwiXG4vLyAgICAgICAgICAgfSxcbi8vICAgICAgICAgICBcImRvd25sb2FkVXJsXCI6IHtcbi8vICAgICAgICAgICAgIFwiU1wiOiBcImh0dHA6Ly9vZ2Njd2VibGluay5zdGF0ZS5jby51cy9Eb3dubG9hZERvY3VtZW50UERGLmFzcHg/RG9jdW1lbnRJZD01MDU1MzEwXCJcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgIH0sXG4vLyAgICAgICAgIFwiU2VxdWVuY2VOdW1iZXJcIjogXCI4OTMwMDAwMDAwMDA1NDc4Njk1ODMyOFwiLFxuLy8gICAgICAgICBcIlNpemVCeXRlc1wiOiAxNjksXG4vLyAgICAgICAgIFwiU3RyZWFtVmlld1R5cGVcIjogXCJORVdfSU1BR0VcIlxuLy8gICAgICAgfSxcbi8vICAgICAgIFwiZXZlbnRTb3VyY2VBUk5cIjogXCJhcm46YXdzOmR5bmFtb2RiOnVzLXdlc3QtMjo4Mzk4MTE3MTIwODA6dGFibGUvY29nY2MtcGRmLXVybHMvc3RyZWFtLzIwMjAtMDItMjJUMjA6NTM6NTUuMjQ3XCJcbi8vICAgICB9XG4vLyAgIF1cbi8vIH1cblxuLy8gaW1wb3J0ICogYXMgQVdTIGZyb20gXCJhd3Mtc2RrXCI7XG5cbi8vIGZ1bmN0aW9uIGRvd25sb2FkKHVybDogc3RyaW5nLCBkZXN0OiBzdHJpbmcpIHtcbi8vICAgLy8gRGVmaW5lcyB3cml0YWJsZSBzdHJlYW0gdG8gb3V0XG4vLyAgIC8vIGNvbnN0IGZpbGUgPSBmcy5jcmVhdGVXcml0ZVN0cmVhbShkZXN0KTtcbi8vICAgaHR0cC5nZXQodXJsLCBmdW5jdGlvbihyZXNwb25zZSkge1xuLy8gICAgIHJlc3BvbnNlLnBpcGUoZmlsZSk7XG4vLyAgIH0pO1xuLy8gfVxuXG4vLyBkb3dubG9hZChcbi8vICAgXCJodHRwOi8vb2djY3dlYmxpbmsuc3RhdGUuY28udXMvRG93bmxvYWREb2N1bWVudFBERi5hc3B4P0RvY3VtZW50SWQ9MjYyNzU2OFwiLFxuLy8gICBcIm91dHB1dC5wZGZcIixcbi8vICAgKCkgPT4ge1xuLy8gICAgIGNvbnNvbGUubG9nKFwiRG9uZVwiKTtcbi8vICAgfVxuLy8gKTtcblxuLy8gLy8gLy8gLy9cblxuaW1wb3J0ICogYXMgaHR0cCBmcm9tIFwiaHR0cFwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgKiBhcyBBV1MgZnJvbSBcImF3cy1zZGtcIjtcbmNvbnN0IHMzb2JqID0gbmV3IEFXUy5TMygpO1xuY29uc3QgUzNfQlVDS0VUX05BTUUgPSBwcm9jZXNzLmVudi5TM19CVUNLRVRfTkFNRSB8fCBcIlwiO1xuXG4vLyAvLyAvLyAvL1xuXG4vLyBEb3dubG9hZHMgYSBmaWxlIGZyb20gYSBVUkwgYW5kIHdyaXRlcyBpdCB0byBgLi90bXAvZmlsZW5hbWVcbi8vIFRPRE8gLSBzaG91bGQgaGF2ZSBlcnJvciBoYW5kbGVyICsgZXJyb3IgbG9nZ2luZ1xuZnVuY3Rpb24gZG93bmxvYWRGaWxlKHVybDogc3RyaW5nLCBkZXN0OiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgY29uc3QgZmlsZSA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKGRlc3QpO1xuICAgIGNvbnNvbGUubG9nKFwiY3JlYXRlZCBmaWxlIHdyaXRlIHN0cmVhbTogXCIgKyBkZXN0KTtcblxuICAgIGh0dHAuZ2V0KHVybCwgcmVzcG9uc2UgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJkb3dubG9hZGVkIGZpbGU6IFwiICsgdXJsKTtcblxuICAgICAgcmVzcG9uc2UucGlwZShmaWxlKTtcbiAgICAgIGZpbGUub24oXCJmaW5pc2hcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwid3JvdGUgdG8gZmlsZVwiKTtcblxuICAgICAgICBmaWxlLmNsb3NlKCk7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cblxuLy8gLy8gLy8gLy9cblxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSBhc3luYyAoZXZlbnQ6IGFueSA9IHt9KTogUHJvbWlzZTxhbnk+ID0+IHtcbiAgLy8gTG9ncyBzdGFydCBtZXNzYWdlICsgUzNfQlVDS0VUX05BTUVcbiAgY29uc29sZS5sb2coXCJkb3dubG9hZC1maWxlIC0tPiBTVEFSVFwiKTtcbiAgY29uc29sZS5sb2coYHdyaXRpbmcgdG8gUzMgYnVja2V0OiAke1MzX0JVQ0tFVF9OQU1FfWApO1xuXG4gIC8vIERlYnVnIGV2ZW50IGlucHV0XG4gIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGV2ZW50LCBudWxsLCA0KSk7XG5cbiAgLy8gUHVsbHMgbmV3SXRlbSBmcm9tIGV2ZW50XG4gIGNvbnN0IG5ld0l0ZW0gPSBldmVudFtcIlJlY29yZHNcIl1bMF1bXCJkeW5hbW9kYlwiXVtcIk5ld0ltYWdlXCJdO1xuICBpZiAoIW5ld0l0ZW0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBQdWxscyBkb3dubG9hZFVybCBmcm9tIG5ld0l0ZW1cbiAgY29uc3QgZG93bmxvYWRVcmwgPSBuZXdJdGVtW1wiZG93bmxvYWRVcmxcIl1bXCJTXCJdO1xuICBjb25zdCBkb2N1bWVudElkID0gbmV3SXRlbVtcIml0ZW1JZFwiXVtcIlNcIl07XG4gIGlmICghZG93bmxvYWRVcmwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBEZWZpbmVzIGZpbGVuYW1lIC0gdXNlZCB0byBzYXZlIGxvY2FsbHkgdG8gbGFtYmRhIChpbiAvdG1wKSBBTkQgaW4gUzMgYnVja2V0XG4gIGNvbnN0IGZpbGVuYW1lID0gZG9jdW1lbnRJZCArIFwiLnBkZlwiO1xuICBjb25zdCBmaWxlcGF0aCA9IFwiL3RtcC9cIiArIGZpbGVuYW1lO1xuXG4gIC8vIExvZ3MgZG93bmxvYWRVcmxcbiAgY29uc29sZS5sb2coYGRvd25sb2FkVXJsOiAke2Rvd25sb2FkVXJsfWApO1xuICBjb25zb2xlLmxvZyhgZG9jdW1lbnRJZDogJHtkb2N1bWVudElkfWApO1xuICBjb25zb2xlLmxvZyhgZmlsZXBhdGg6ICR7ZmlsZXBhdGh9YCk7XG5cbiAgLy8gRG93bmxvYWRzIGZpbGUgdG8gL3RtcFxuICBhd2FpdCBkb3dubG9hZEZpbGUoZG93bmxvYWRVcmwsIGZpbGVwYXRoKTtcblxuICAvLyBTYXZlcyBuZXcgZmlsZSB0byBTM1xuICBzM29ialxuICAgIC51cGxvYWQoe1xuICAgICAgQnVja2V0OiBTM19CVUNLRVRfTkFNRSxcbiAgICAgIEtleTogZG9jdW1lbnRJZCArIFwiLnBkZlwiLFxuICAgICAgQm9keTogZnMucmVhZEZpbGVTeW5jKGZpbGVwYXRoKVxuICAgIH0pXG4gICAgLnNlbmQoKGVyciwgZGF0YSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyLCBkYXRhKTtcbiAgICAgIC8vIExvZ3MgZXJyb3JcbiAgICAgIC8vIFRPRE8gLSB3aXJlIHVwIHByb3BlciBlcnJvciBsb2dnaW5nXG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBkb3dubG9hZC1maWxlIC0tPiBFUlJPUmApO1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhgZG93bmxvYWQtZmlsZSAtLT4gU1VDQ0VTUyAtLT4gJHtmaWxlbmFtZX1gKTtcbiAgICB9KTtcbn07XG4iXX0=